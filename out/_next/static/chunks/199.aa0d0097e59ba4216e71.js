(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{4199:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Y}});var r=t(2982),o=t(4942),a=(t(1664),t(381)),c=t.n(a),i=t(7294);const s=(0,i.createContext)(null),u=s.Provider;function l(){const e=(0,i.useContext)(s);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function f(){return l().map}t(3935);function d(e){function n(n,t){const{instance:r,context:o}=e(n).current;return(0,i.useImperativeHandle)(t,(()=>r)),null==n.children?null:i.createElement(u,{value:o},n.children)}return(0,i.forwardRef)(n)}function p(e){function n(n,t){const{instance:r}=e(n).current;return(0,i.useImperativeHandle)(t,(()=>r)),null}return(0,i.forwardRef)(n)}function m(e,n){return null==n?function(n,t){return(0,i.useRef)(e(n,t))}:function(t,r){const o=(0,i.useRef)(e(t,r)),a=(0,i.useRef)(t),{instance:c}=o.current;return(0,i.useEffect)((function(){a.current!==t&&(n(c,t,a.current),a.current=t)}),[c,t,r]),o}}function v(e,n){const t=(0,i.useRef)();(0,i.useEffect)((function(){return null!=n&&e.instance.on(n),t.current=n,function(){null!=t.current&&e.instance.off(t.current),t.current=null}}),[e,n])}function h(e,n){const t=e.pane??n.pane;return t?{...e,pane:t}:e}function b(e,n){(0,i.useEffect)((function(){return(n.layerContainer??n.map).addLayer(e.instance),function(){var t;null==(t=n.layerContainer)||t.removeLayer(e.instance),n.map.removeLayer(e.instance)}}),[n,e])}function g(e){return function(n){const t=l(),r=e(h(n,t),t);return function(e,n){const t=(0,i.useRef)(n);(0,i.useEffect)((function(){n!==t.current&&null!=e.attributionControl&&(null!=t.current&&e.attributionControl.removeAttribution(t.current),null!=n&&e.attributionControl.addAttribution(n)),t.current=n}),[e,n])}(t.map,n.attribution),v(r.current,n.eventHandlers),b(r.current,t),r}}function x(e){return function(n){const t=l(),r=e(h(n,t),t);return v(r.current,n.eventHandlers),b(r.current,t),function(e,n){const t=(0,i.useRef)();(0,i.useEffect)((function(){if(n.pathOptions!==t.current){const r=n.pathOptions??{};e.instance.setStyle(r),t.current=r}}),[e,n])}(r.current,n),r}}var y=t(5243),_=t.n(y);const j=d(x(m((function({bounds:e,...n},t){const r=new y.Rectangle(e,n);return{instance:r,context:{...t,overlayContainer:r}}}),(function(e,n,t){n.bounds!==t.bounds&&e.setBounds(n.bounds)}))));function w(){return(w=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function C({children:e,className:n,id:t,placeholder:r,style:o,whenCreated:a,...c}){const s=(0,i.useRef)(null),l=function(e,n){const[t,r]=(0,i.useState)(null);return(0,i.useEffect)((()=>{if(null!==e.current&&null===t){const t=new y.Map(e.current,n);null!=n.center&&null!=n.zoom?t.setView(n.center,n.zoom):null!=n.bounds&&t.fitBounds(n.bounds,n.boundsOptions),null!=n.whenReady&&t.whenReady(n.whenReady),r(t)}}),[e,t,n]),t}(s,c),f=(0,i.useRef)(!1);(0,i.useEffect)((()=>{null!=l&&!1===f.current&&null!=a&&(f.current=!0,a(l))}),[l,a]);const[d]=(0,i.useState)({className:n,id:t,style:o}),p=(0,i.useMemo)((()=>l?{__version:1,map:l}:null),[l]),m=p?i.createElement(u,{value:p},e):r??null;return i.createElement("div",w({},d,{ref:s}),m)}const O=function(e,n){return p(g(m(e,n)))}((function({url:e,...n},t){return{instance:new y.TileLayer(e,h(n,t)),context:t}}),(function(e,n,t){const{opacity:r,zIndex:o}=n;null!=r&&r!==t.opacity&&e.setOpacity(r),null!=o&&o!==t.zIndex&&e.setZIndex(o)})),E=function(e,n){return d(g(m(e,n)))}((function({position:e,...n},t){const r=new y.Marker(e,n);return{instance:r,context:{...t,overlayContainer:r}}}),(function(e,n,t){n.position!==t.position&&e.setLatLng(n.position),null!=n.icon&&n.icon!==t.icon&&e.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==t.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==t.opacity&&e.setOpacity(n.opacity),null!=e.dragging&&n.draggable!==t.draggable&&(!0===n.draggable?e.dragging.enable():e.dragging.disable())})),k=(S=function(e){return new y.Control.Zoom(e)},p((N=m((function(e,n){return{instance:S(e),context:n}})),function(e){const n=l(),t=N(e,n),{instance:r}=t.current,o=(0,i.useRef)(e.position),{position:a}=e;return(0,i.useEffect)((function(){return r.addTo(n.map),function(){r.remove()}}),[n.map,r]),(0,i.useEffect)((function(){null!=a&&a!==o.current&&(r.setPosition(a),o.current=a)}),[r,a]),t})));var N,S;var z=function(e,n,t,r){return new(_().DivIcon)({className:"text-icon",html:'<div style="color:'.concat(r,' !important;" class="').concat(n?"text_label next_event":"text_label",'">')+e+"</div>",iconSize:t})},H=t(7433),D=(t(6538),t(8193)),R=t(5893);function I(e){var n=e.handlePanel,t=e.continent,r=e.handleTerritory,o=(0,i.useState)(null),a=o[0],c=o[1];return(0,i.useEffect)((function(){c(t)}),[t]),(0,R.jsx)(R.Fragment,{children:a&&(0,R.jsxs)("div",{className:"popupLayerWrap",children:[(0,R.jsxs)("div",{className:"title",children:[a.name,(0,R.jsx)("div",{className:"close_btn",onClick:function(){c(null),n()},children:(0,R.jsx)(D.LHV,{})})]}),(0,R.jsxs)("div",{className:"popupContentWrap",children:[(0,R.jsx)("div",{className:"message",children:" \ud074\ub9ad\ud558\uba74 \ud574\ub2f9 \uc9c0\ub3c4\ub85c \uc774\ub3d9 \ub429\ub2c8\ub2e4. "}),(0,R.jsx)("div",{className:"popupContent",children:a.territories.map((function(e,n){return(0,R.jsx)("div",{className:"report_list_item",onClick:function(){r(e)},children:(0,R.jsx)("p",{className:"report_title lis",children:e.name})},n)}))})]})]})})}t(8592);var Z=function(e,n){return new(_().DivIcon)({className:"report-marker",html:'<div class="report_on_map_wrap"><div>'+e.territory.name+"</div>"+'<div style="color:'.concat(e.itemcard.class,'">')+e.itemcard.name+"</div>"+'<div style="color:'.concat(e.itemfavor.class,'">')+e.itemfavor.name+"</div></div>"})},P=t(3750);function L(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function M(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?L(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var W=[-.3932,-12.1165],A={bottomleft:"leaflet-bottom leaflet-left",bottomright:"leaflet-bottom leaflet-right",topleft:"leaflet-top leaflet-left",topright:"leaflet-top leaflet-right"},B={weight:1};function T(e){var n=e.parentMap,t=e.zoom,r=f();!function(e,n){const t=f();(0,i.useEffect)((function(){return t.on(e,n),function(){t.off(e,n)}}),[t,e,n])}("click",(0,i.useCallback)((function(e){n.setView(e.latlng,n.getZoom())}),[n]));var o=(0,i.useState)(n.getBounds()),a=o[0],c=o[1],s=(0,i.useCallback)((function(){c(n.getBounds()),r.setView(n.getCenter(),t)}),[r,n,t]),u=(0,i.useMemo)((function(){return{move:s,zoom:s}}),[]);return v({instance:n},u),(0,R.jsx)(j,{bounds:a,pathOptions:B})}function V(e){var n=e.position,t=e.zoom,r=e.url,o=f(),a=t||0,c=(0,i.useMemo)((function(){return(0,R.jsxs)(C,{style:{height:80,width:80},center:o.getCenter(),zoom:a,dragging:!1,doubleClickZoom:!1,scrollWheelZoom:!1,attributionControl:!1,zoomControl:!1,children:[(0,R.jsx)(O,{noWrap:!0,url:r}),(0,R.jsx)(T,{parentMap:o,zoom:a})]},r)}),[]),s=n&&A[n]||A.topright;return(0,R.jsx)("div",{className:s,children:(0,R.jsx)("div",{className:"leaflet-control leaflet-bar",children:c})})}var Y=function(e){var n,t=e.server,o=e.reports,a=(0,i.useState)(null),s=(a[0],a[1]),u=(0,i.useState)(3),l=u[0],f=u[1],d=(0,i.useState)({}),p=d[0],m=d[1],v=(0,i.useState)({}),h=v[0],b=v[1],g=(0,i.useState)(null),x=g[0],y=g[1],_=(0,i.useState)(!1),j=_[0],w=_[1],N=(0,i.useState)(2),S=N[0],L=N[1],A=(0,i.useState)(6),B=A[0],T=A[1],Y=(0,i.useState)(null),K=Y[0],F=Y[1],U=(0,i.useState)(!1),q=(U[0],U[1],(0,i.useState)("")),G=q[0],J=q[1];switch(t){case"Lufeon":n="\ub8e8\ud398\uc628";break;case"Silian":n="\uc2e4\ub9ac\uc548";break;case"Aman":n="\uc544\ub9cc";break;case"Karmain":n="\uce74\ub9c8\uc778";break;case"Kazeros":n="\uce74\uc81c\ub85c\uc2a4";break;case"Abrelshud":n="\uc544\ube0c\ub810\uc288\ub4dc";break;case"Kardan":n="\uce74\ub2e8";break;case"Ninave":n="\ub2c8\ub098\ube0c"}var Q=function(e,n,t){var r=[];return e.forEach((function(e){var o=!1,a="#fff";n.forEach((function(n){e.id===n.id&&(o=!0,a=t)})),r.push(M(M({},e),{},{next_value:o,origin_color:a}))})),r};(0,i.useEffect)((function(){y("map/{z}/tile_{x}_{y}.jpg"),H.Z.get("/continents").then((function(e){var t=e.data,o=[];t.forEach((function(e){"\ub8e8\ud14c\ub780 \ub3d9\ubd80"===e.name&&o.push.apply(o,(0,r.Z)(e.territories))})),t=t.map((function(e){return"\ub8e8\ud14c\ub780 \ub3d9\ubd80"===e.name&&(e.territories=o),e})),m(t),H.Z.get("/periodicevents").then((function(e){var r=new Date,o=function(e,n){var t={},r={},o=!1,a=c()(n,"HH:mm:ss").toDate(),i=0,s=0;if(e.forEach((function(e){var n=c()(e.end,"HH:mm:ss").toDate(),u=c()(e.start,"HH:mm:ss").toDate();a<=n&&a>=u?(t=e,o=!0):a<=u?a>=s&&(r=e,s=u):a>=n&&a<=i&&(t=e,i=n)})),!o&&void 0===r.id){var u=c()("00:00","HH:mm:ss").toDate();e.forEach((function(e){var n=c()(e.end,"HH:mm:ss").toDate(),a=c()(e.start,"HH:mm:ss").toDate();u<=n&&u>=a?(t=e,o=!0):u<=a?u>=s&&(r=e,s=a):u>=n&&u<=i&&(t=e,i=n)}))}return{event_status:o,current_data:t,next_data:r}}(e.data,r);if(o.event_status){var a=c()().format("HH"),i=c()().format("YYYY-MM-DD"),s="".concat(a,":30:00"),u="".concat(a,":55:00"),l=o.current_data.continents,f=Q(t,l,"#ffeb55");m(f),H.Z.get("/reports?_sort=published_at:DESC&_where[0][report_date_gte]=".concat(s,"&_where[1][report_date_lte]=").concat(u,"&_where[2][created_at_gte]=").concat(i,"&_where[0][server.name]=").concat(encodeURI(n))).then((function(e){var n=e.data;b(n)}))}else{var d=o.next_data.continents,p=Q(t,d,"#efafff");m(p)}}))}))}),[]);var X=(0,i.useCallback)((function(e){F(null)}));(0,i.useEffect)((function(){o&&(y(o.iamge),w(!0),J(o.name),f(1),L(1),T(2))}),[o]);var $=(0,i.useCallback)((function(e){y(e.iamge),w(!0),J(e.name),f(1),L(1),T(2),X()}));return(0,R.jsxs)(R.Fragment,{children:[j&&(0,R.jsxs)("div",{className:"maps_button_wrap",children:[(0,R.jsxs)("div",{className:"maps_on_off btn",onClick:function(){return y("map/{z}/tile_{x}_{y}.jpg"),w(!1),f(3),L(2),void T(6)},children:[(0,R.jsx)(P.e6h,{}),(0,R.jsx)("div",{children:"\ub3cc\uc544\uac00\uae30"})]}),(0,R.jsxs)("div",{className:"maps_on_off info",children:[(0,R.jsx)(D.kA6,{}),(0,R.jsx)("div",{children:G})]})]}),(0,R.jsxs)(C,{className:"loa-map",center:W,zoom:l,maxZoom:B,minZoom:S,scrollWheelZoom:!0,zoomControl:!1,style:{height:"100vh",width:"100%",boxSizing:"border-box",backgroundColor:"rgb(0, 0, 0)"},whenCreated:s,children:[(0,R.jsx)(O,{noWrap:!0,url:x},x),(0,R.jsx)(V,{position:"topright",url:x}),!j&&p.length>0&&p.map((function(e){return(0,R.jsx)(E,{position:e.location,icon:z(e.name,e.next_value,30,e.origin_color),eventHandlers:{click:function(n){!function(e){F(e)}(e)}}},e.id)})),!j&&h.length>0&&h.map((function(e){return(0,R.jsx)(E,{position:e.continent.location_event,icon:Z(e,10)},e.id)})),(0,R.jsx)(k,{position:"bottomright"})]},x),(0,R.jsx)(I,{continent:K,handlePanel:X,handleTerritory:$})]})}},6538:function(){}}]);